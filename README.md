# Road Segmentation
ETH Computational Intelligence Lab - Project Road Segmentation

**`Team Name`:** roadtripper

**`Team Members`:** Zhehan Fu, Jonas Bokstaller, Yihang She, Tommaso Macr√¨

## Model description
There are three models defined in model.py. They are U-Nets with two major improvements:
1. Adding residual connections in convolutional blocks
2. Using dilated convolutions in bottleneck part

Model A: U-Net with 32 channels on the first layer, and local skip connections (improvement #1 only) (defined in unet)
Model B: U-Net with 64 channels on the first layer, and local skip connections (improvement #1 only again, but more parameters to train)
Model C: U-Net with dilated conovlution bottleneck, and local skip connections (improvement #1 & #2), 32 channels on the first layer (defined in unet_dilated)

The models are trained using keras (version 2.2.4).


## Instructions

In order to reproduce the result we submitted on kaggle, please follow the instructions as following:

* Please make sure ```Python 3.6.8``` and packages in ```requirements.txt``` are installed.

~~~~shell
pip install -r requirements.txt
~~~~

* Training and testing aerial images are stored already in ```training``` and ```test``` folders under the ```data\``` folder.

* We have stored currently the test results of three individual models and the one submitted (which does an averaging on the masks generated by three models) under the ```submission\``` folder.

~~~~shell
python run.py
~~~~

* If you want to retrain the three models, please run ```train_predict.py```. Then the ```submission.csv``` file will be generated directly under the  ```submission\``` folder.

~~~~shell
python train_predict.py
~~~~

## Modules and Notebooks

### ```data.py```

Functions for data preprocessing.
This will:
- make horizontal and vertical flips to image patches;
- rotate images by 90, 180, and 270 degrees;
By running the function in this module, the aforementioned changes will be exerted onto image files, a ```data\validation\``` folder will be generated (20% of patches will be moved to this). If this is done, and setting is not changed, this will not happen in the next run.

### ```losses.py```, 	```metrics.py```

Define: Dice coefficient calculation, Dice loss, BinaryCrossentropy loss and F1 score (used to evaluate models).

### ```model.py```

*  `unet`: Modified U-Net with local skip connection (as in ResNet), dropout and batch-normalization
*  `unet_dilated`: U-Net with dilated convolution as bottlenect; dropout is not used in this model.


### ```mask_to_submission.py```

Helper functions provided on kaggle for generating submission file.

### ```train_predict.py```

Script to retrain models and get the prediction results.

### ```run.py```

Script to generate the same submission csv file.
Note: The prerequisite is to have model parameters of the model used in this file stored already in the  ```weights\``` folder

## License

The project is licensed under the MIT License.
